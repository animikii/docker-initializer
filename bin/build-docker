#!/usr/bin/env bash

### -----------------------------------
### This will ensure the entire script exits if any of the child scripts exit
set -e

### -----------------------------------
### Copy necessary files that are not versioned in the repo or require user input

# if ! test -f ".env"; then
#   cp .env.example .env
# fi

# if ! test -f "config/database.yml"; then
#   cp config/database.yml.example config/database.yml
# fi

# if ! test -f "config/master.key"; then
#   touch config/master.key
  
#   echo "Please enter the master.key:"
#   read -sp 'key: ' KEY
#   echo $KEY > config/master.key
# fi

# ----------------------------------- Build the web container and tag it
docker build . -f ./Dockerfile -t TAGNAME

### -----------------------------------
### Start the container

docker-compose up -d

# bin/exec rails db:setup

# bin/exec yarn install

# bin/exec rails db:test:prepare

docker-compose stop
